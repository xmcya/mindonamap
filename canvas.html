<html>
  <head>
    <title>Mindmap</title>
    <style type="text/css">
      canvas { border: 1px solid black; }
    </style>
  </head>
  <body onload="init();">
	  
	<style type="text/css">
		<!--
		
		a{font-family:Verdana, sans-serif;} 
		
		#site {
		  margin: 0 auto;
		  width: 1200px;
		  height: 800;
		}
		
		#canvas {
			float:left;
			width:800px;
		}
		#navi_add {
			margin-left: 810px;
			width: 300px;
			background-color:lightblue;
		}
		#navi_mode {
			margin-left: 810px;
			width: 300px;
			background-color:lightyellow;
		}
		#navi_edit {
			margin-left: 810px;
			width: 300px;
			background-color:lightgreen;
		}
		-->
	</style>
	
	<div id=site>
		<div id=canvas>
			<canvas id="tutorial" width="800" height="600"
				style="border:2px solid #000000;">
			</canvas>
		</div>
		
		<!-- <div id=navi_add>
			<a>Size: </a><input type="number" id="inputSize" value="30"></br>
			<a>PosX: </a><input type="number" id="inputPosX" value="30"></br>
			<a>PosY: </a><input type="number" id="inputPosY" value="30"></br>
			<button name="buttonGo" onclick="go();">Ok</button></br>
		</div> -->
		
		<div id=navi_mode>
			<input type="radio" name="mode" value="add" checked onclick="mode=0"><a> Add</a></br>
			<input type="radio" name="mode" value="move" onclick="mode=1"><a> Move/Edit</a></br>
			<!-- <input type="radio" name="mode" value="connect" onclick="mode=3"><a> Connect</a></br> -->
			<input type="radio" name="mode" value="delete" onclick="mode=2"><a> Delete</a></br>
		</div>
		
		<div id=navi_edit>
			<a>Current Node:</a></br>
			<a>Name: </a><input type="text" id="NodeName" value="---"></br>
			<a>Size: </a><input type="number" id="NodeSize" value="0"></br>
			<button name="buttonGo" onclick="editNode();">Change</button></br>
		</div>
	</div>
  </body>

  <script type="text/javascript">

		var context;
		var mode = 0;
		var currentNode = null;
		var nodes =[];

		function Node(posx,posy,width,height){
			this.posx = posx;
			this.posy = posy;
			this.draw = draw;
			this.text = "Node";
			this.color = "white";
			//this.size = size;
			this.width = width;
			this.height = height;
			this.supernode = null;
			this.connections = [];
		}

		function init(){
			nodes.push(new Node(100,100,60,40));
			drawAll();
		}

		function draw(){
			
			var connected = this.connections;
			
			for(var j=0; j < connected.length; j++){
				context.moveTo(this.posx + this.width/2, 
							   this.posy + this.height/2);
							   
				context.lineTo(connected[j].posx + connected[j].width/2, 
							   connected[j].posy + connected[j].height/2);
							   
				context.stroke();	
			}
			
			context.beginPath();
			//context.arc(this.posx,this.posy,this.size,0,Math.PI*2,true);
			context.rect(this.posx,this.posy,this.width,this.height);
			context.strokeStyle = 'black';
			context.fillStyle = this.color;
			context.fill();
			context.stroke();
			
			context.fillStyle = 'black';
			
			var metrics = context.measureText(this.text);
			
			context.fillText(this.text,
							 this.posx + this.width/2 - metrics.width/2, 
							 this.posy + this.height/2);
		}

		function drawAll(){
			
			var canvas = document.getElementById('tutorial');

			if (canvas.getContext){
				context = canvas.getContext('2d');
				context.clearRect(0,0,canvas.width,canvas.height);

				for(var i=0; i < nodes.length; i++){
					nodes[i].draw(context);
				}
			}
		}

		function getClickedNode(posx,posy){
			
			for(var i=nodes.length-1; i >= 0; i--){
				
				/*if( (Math.pow(nodes[i].posx-posx,2)+Math.pow(nodes[i].posy-posy,2)) <= (nodes[i].size*nodes[i].size)){
					return nodes[i];
				}*/
				
				if(posx > nodes[i].posx && posx < (nodes[i].posx + nodes[i].width) &&
				   posy > nodes[i].posy && posy < (nodes[i].posy + nodes[i].height)){
					return nodes[i];
				}
			}
			
			return null;
		}

		document.getElementById('tutorial').onmousedown = function(e){

			e = e || window.event;
			
			var rect = this.getBoundingClientRect();

			var posx = e.clientX - rect.left;
			var posy = e.clientY - rect.top;

			//Add
			if(mode == 0){
				
				if(currentNode === null){
					
					currentNode = getClickedNode(posx,posy);
					
					if(currentNode !== null){
						var inputNodeName = document.getElementById('NodeName');
						inputNodeName.value = currentNode.text;
						var inputNodeSize = document.getElementById('NodeSize');
						inputNodeSize.value = currentNode.size;
						currentNode.color = "purple";
					}
					
				}else{
					var newNode = new Node(posx,posy,40,40)
					nodes.push(newNode);
					currentNode.connections.push(newNode);
					newNode.superNode = currentNode;
					currentNode.color = "white";
					currentNode = null;
				}
				
			//Move
			}else if(mode == 1){
				
				if(currentNode === null){
					
					currentNode = getClickedNode(posx,posy);
					
					if(currentNode !== null){
						var inputNodeName = document.getElementById('NodeName');
						inputNodeName.value = currentNode.text;
						var inputNodeSize = document.getElementById('NodeSize');
						inputNodeSize.value = currentNode.size;
						currentNode.color = "purple";
					}
					
				}else{
					currentNode.color = "white";
					currentNode.posx = posx;
					currentNode.posy = posy;
					currentNode = null;
				}
			//Delete
			}else if(mode == 2){
				
				for(var i=nodes.length-1; i >= 1; i--){
						
					//if( (Math.pow(nodes[i].posx-posx,2) + Math.pow(nodes[i].posy-posy,2)) <= (nodes[i].size*nodes[i].size)){
					if(posx > nodes[i].posx && posx < (nodes[i].posx + nodes[i].width) &&
					   posy > nodes[i].posy && posy < (nodes[i].posy + nodes[i].height)){
					   
						var superNode = nodes[i].superNode;
						
						for(var j =0; j < superNode.connections.length; j++){
							if(superNode.connections[j] == nodes[i]){
								superNode.connections.splice(j,1);
								break;
							}
						}
						
						if(nodes[i].connections !== null){
							for(var k =0; k < nodes[i].connections.length; k++){
								nodes[i].connections[k].superNode = superNode;
								superNode.connections.push(nodes[i].connections[k]);
							}
						}
						
						nodes.splice(i,1);
						break;
					}
				}
			}
			
			drawAll();
			
		};

		/*function go(){
			var size = document.getElementById('inputSize').value;
			var posx = document.getElementById('inputPosX').value;
			var posy = document.getElementById('inputPosY').value;
			
			nodes.push(new Node(size,posx,posy));

			drawAll();
		}*/
		
		function editNode(){
			
			if(currentNode !== null){
				var inputNodeName = document.getElementById('NodeName');
				var inputNodeSize = document.getElementById('NodeSize');
				currentNode.size = inputNodeSize.value;
				currentNode.text = inputNodeName.value;
			}
			
			drawAll();
		}



  </script>
</html>

